#!/usr/bin/env bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
REPO_ROOT="$SCRIPT_DIR"

if [[ -z "${TMUX:-}" ]]; then
	if [[ "${TMUXWATCH_FORCE_TMUX:-0}" == "1" ]]; then
		echo "tmuxwatch must run inside tmux. Try: tmux new-session -s watch './gorunfresh'" >&2
		exit 1
	fi
	echo "[tmuxwatch] TMUX not detected; running directly. Set TMUXWATCH_FORCE_TMUX=1 to require tmux." >&2
fi

if [[ "${1:-}" == "--watch" ]]; then
	shift
	exec "$REPO_ROOT/scripts/run-watch.sh" "$@"
fi

exec "$REPO_ROOT/scripts/run-fresh.sh" "$@"
